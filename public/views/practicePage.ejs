<%- include('includes/headerLoggedIn') %>
<!--Flowers FOR Spring-->
<%- include('includes/falling') %>

<!-- ERRORS -->
<% adErrors.forEach(function(message) { %>
  <div class="alert alert-danger text-center small py-1 mt-2"><%= message %></div>
<% }) %>

<!--WALLET-->
<%- include('includes/wallet') %>

<!-- PRACTICE HUB -->
<!-- linebreaks are rendered in textarea placeholder -->
<div id="practice-guide" class="aboveFalling transparentBG mt-2 mb-4 section">
  <div class="py-4 my-4 mb-2 mx-0"><h1 id="headingText" class="px-5 display-2 recursive rainbowText text-center">PRACTICE</h1>
    <!--DISPLAY WEEKLY COMMENTS-->
    <% latestComments.forEach((comment) => { %>
      <div id="weeklySnapshot" class="mt-5 px-1"><%- filterUserHTML(comment.comments) %></div>  
      <div id="print-button" class="text-center mt-5 pt-5 pb-2">
        <button class="mx-3 my-5 btn btn-outline-secondary btn-sm" href="#" onclick="printDiv('weeklySnapshot')">Print notes</button>
      </div>
    <% }) %>
    <!--RECORDED LESSON-->
    <div id="recordedLesson" class="aboveFalling mb-5 rounded">
      <% if(recordedLessonURL){ %>
      <div class="responsive-container">
        <iframe style="z-index: 99999;" class="" width="100%" height="500px" src="<%= recordedLessonURL %>" title="Latest lesson recording" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>
      </div>
      <% } %>
    </div>
    <!--DISPLAY CONVERSATION-->
    <div class="w-100 d-flex topShadow rounded" style="z-index: -2;overflow-y: auto;height:300px;">
      <div id="practiceConversation" class="mx-auto pt-4 px-4" style="z-index: -1;">
        <% practiceConversation.forEach((entry) => { 
          if(entry[0] == 'You') { %>
            <p class="grey-text"><span class="orange-text"><%= entry[0] %></span> : <%= entry[1] %></p>
          <% } else if(entry[0] == 'Hanford') { %>
            <p class="grey-text"><span class="purple-text"><%= entry[0] %></span> : <%= entry[1] %></p>
          <% }
        }) %>
      </div>
    </div>
    <!--DISPLAY REPLY BOX IF NO PRACTICE STATUS-->
    <% if (!practiceStatus) { %>
      <form id="PracticeConvo" class="my-2" action="/updateLastSubmittedDateAndAddPoints" method="POST">
        <input type="hidden" name="_csrf" value="<%= csrfToken %>">
        <div class="form-group text-center" style="width:60%;margin:0 auto;">
          <textarea autocomplete="off" name="practiceConversation" class="form-control" style="background-color: rgb(30, 20, 51);color:chartreuse;" 
          placeholder="<%= practicePrompt %>&#10; &#10;" id="practiceConversation" rows="6"></textarea>
          <button  type="submit" class="btn btn-outline-success btn-lg mt-4" style="font-size: 1.2rem;">Reply</button>
        </div>
      </form>
    <% } else { %>
      <div id="practice-success" class="recursive text-center mt-5 my-2">
        <p><span class="green-text">Come back tomorrow for Hanford's reply!</span><br><span class="orange-text">Some points have been added to your wallet.</span></p>
      </div>
    <% } %>
  </div>
</div>

<script>
  // PRINT FEATURE PLAIN TEXT
  function printDiv(elementId) {
    var prtContent = document.getElementById(elementId);
    var WinPrint = window.open('', '', 'left=0,top=0,width=800,height=900,toolbar=0,scrollbars=0,status=0');
    WinPrint.document.write(prtContent.innerHTML);
    WinPrint.document.close();
    WinPrint.focus();
    WinPrint.print();
  }

  // prevent multisubmits
  try {
    (function() {
      let frm = document.getElementById("PracticeConvo")
      var allowSubmit = true;
      frm.onsubmit = function () {
        if (allowSubmit)
            allowSubmit = false;
        else 
            return false;
      }
    })();
  } catch(err) {
    console.log(err);
  }
</script>

<%- include('includes/footer') %>